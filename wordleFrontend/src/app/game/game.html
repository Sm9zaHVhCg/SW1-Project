@if(showCategoryModal) {
  <div class="fixed inset-0 bg-black/30 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col gap-4 w-80 popup-animate">
      <h2 class="text-xl font-semibold text-center">Select a category</h2>
      <div class="flex gap-3 justify-center mt-2">
        <button class="key" (click)="categorySelected('sports')">Sports</button>
        <button class="key" (click)="categorySelected('cars')">Cars</button>
        <button class="key" (click)="categorySelected('animals')">Animals</button>
      </div>
    </div>
  </div>
}

@if(resultsPopup) {
  <div class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6 flex flex-col gap-4 relative">
      <!-- Close Button -->
      <button
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 font-bold text-xl"
        (click)="resultsPopup = false; tab='me'">
        âœ•
      </button>

      <!-- Header -->
      <h2 class="text-2xl font-bold text-center"
          [ngClass]="stats.won ? 'text-green-600' : 'text-red-600'">
        {{ stats.won ? 'ðŸŽ‰ You won!' : 'ðŸ˜¢ You lost!' }}
      </h2>

      <!-- Stats -->
      <div class="flex justify-around text-lg font-semibold text-gray-800">
        <div>Attempts: <span class="text-gray-900">{{ stats.attempts }}</span></div>
        <div>Time: <span class="text-gray-900">{{ ((stats.timeTaken ?? 0)/1000) | number:'1.0-0' }} s</span></div>
      </div>

      <!-- Tabs -->
      <div class="flex border-b border-gray-300 mt-2">
        <button
          class="flex-1 py-2 text-center font-semibold"
          [ngClass]="tab === 'me' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'"
          (click)="tab='me'">
          My Result
        </button>
        <button
          class="flex-1 py-2 text-center font-semibold"
          [ngClass]="tab === 'board' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'"
          (click)="tab='board'">
          Leaderboard
        </button>
      </div>

      <!-- Tab Content -->
      <div class="mt-3">
        @if(tab === 'me') {
          <div class="text-center text-gray-900 space-y-2">
            <p class="font-semibold text-lg">Your Result</p>
            <p>Attempts: <span class="font-bold">{{ stats.attempts }}</span></p>
            <p>Time: <span class="font-bold">{{ ((stats.timeTaken ?? 0)/1000) | number:'1.0-0' }} s</span></p>
          </div>
        }
        @if(tab === 'board') {
          <div class="space-y-2 max-h-64 overflow-y-auto">
            @for(entry of leaderboard; track $index) {
              <div class="p-2 bg-gray-50 rounded flex justify-between font-medium text-gray-900">
                <span>{{ entry.name }}</span>
                <span>{{ entry.attempts }} guesses - {{ (entry.timeTaken/1000) | number:'1.0-0' }} s</span>
              </div>
            }
          </div>
        }
      </div>
    </div>
  </div>
}

<!-- Game itself -->
<div class="min-h-screen flex flex-col items-center justify-center bg-slate-100">
  <div class="bg-white p-6 rounded-xl shadow-lg space-y-6">

    <!--Guesses area-->
    <div class="space-y-3.5">
      @for(guess of guesses; track $index) {
        <div class="flex gap-1 justify-center">
          @for(box of guess; track $index){
            <div
              class="tile"
              [ngClass]="[
              box.revealed ? box.color : '',
              box.flip ? 'flip' : '',
              box.pop ? 'pop' : '']"
              >{{ box.letter }}</div>
          }
        </div>
      }
    </div>
    <!-- Message area -->
    <div
      class="h-8 text-center text-lg font-semibold transition-opacity duration-200"
      [ngClass]="message === 'You won !' ? 'win' : 'text-slate-800'"
      [class.opacity-0]="!message">
      {{ message }}
    </div>

    <!-- Keyboard -->
    <div class="keyboard space-y-2 select-none">
      <div class="flex gap-1 justify-center">
        @for(letter of top; track $index) {
          <button
            class="key"
            (click)="letterClicked(letter)">
            {{ letter }}
          </button>
        }
      </div>
      <div class="flex gap-1 justify-center">
        @for(letter of middle; track $index) {
          <button
            class="key"
            (click)="letterClicked(letter)">
            {{ letter }}
          </button>
        }
      </div>
      <div class="flex gap-1 justify-center">
        <!-- Delete button -->
        <button
          class="key key-wide"
          (click)="deleteClicked()">
          âŒ«
        </button>
        <!-- letters -->
        @for(letter of bottom; track $index) {
          <button
            class="key"
            (click)="letterClicked(letter)">
            {{ letter }}
          </button>
        }
        <!-- Enter button -->
        <button
          class="key key-wide"
          (click)="enterClicked()">
          â†µ
        </button>
      </div>
    </div>
  </div>
</div>

