@if (showCategoryModal) {
  <div class="fixed inset-0 bg-black/30 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col gap-4 w-80 popup-animate">
      <h2 class="text-xl font-semibold text-center text-gray-700">Select a category</h2>
      <div class="flex gap-3 justify-center mt-2">
        <button class="key" (click)="categorySelected('sports')">Sports</button>
        <button class="key" (click)="categorySelected('cars')">Cars</button>
        <button class="key" (click)="categorySelected('animals')">Animals</button>
      </div>
    </div>
  </div>
}

@if (resultsPopup) {
  <div class="fixed inset-0 bg-black/30 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6 flex flex-col gap-4 relative animate-scale-in">

      <!-- Close Button -->
      <button
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 font-bold text-xl"
        (click)="resultsPopup = false; tab='me'">
        âœ•
      </button>

      <!-- Header -->
      <h2 class="text-2xl font-bold text-center"
          [ngClass]="stats.won ? 'text-green-600' : 'text-red-600'">
        {{ stats.won ? 'ðŸŽ‰ You won!' : 'ðŸ˜¢ You lost!' }}
      </h2>

      <!-- Stats -->
      <div class="flex justify-around text-lg font-semibold text-gray-700">
        <p>
          {{ stats.won ? 'Great job!' : 'Better luck next time!' }} Check the leaderboard to see how you compare ðŸš€
        </p>
      </div>

      <!-- Word of the Day -->
      @if (wordInfo) {
        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-center space-y-2">
          <p class="text-sm uppercase tracking-wide text-gray-500 font-semibold">
            Word of the Day
          </p>

          <p class="text-xs text-gray-400">
            Category: <span class="font-semibold text-gray-600">{{ wordInfo.category }}</span>
          </p>

          <p class="text-l font-bold text-gray-800">
            {{ wordInfo.word }}
          </p>
          <p class="text-gray-600 text-sm leading-relaxed">
            {{ wordInfo.definition }}
          </p>
        </div>
      }

      <!-- Tabs -->
      <div class="flex border-b border-gray-300 mt-2">
        <button
          class="flex-1 py-2 text-center font-semibold"
          [ngClass]="tab === 'me' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'"
          (click)="tab='me'">
          My Result
        </button>
        <button
          class="flex-1 py-2 text-center font-semibold"
          [ngClass]="tab === 'board' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'"
          (click)="tab='board'">
          Leaderboard
        </button>
      </div>

      <!-- Tab Content -->
      <div class="mt-3">
        @if (tab === 'me') {
          <div class="text-center text-gray-900 space-y-2">
            <p class="font-semibold text-lg">Your Result</p>
            <p>Attempts: <span class="font-bold">{{ stats.attempts }}</span></p>
            <p>Time: <span class="font-bold">{{ ((stats.timeTaken ?? 0) / 1000) | number:'1.0-0' }} s</span></p>
          </div>
        }
        @if (tab === 'board') {
          <div class="space-y-2 max-h-64 overflow-y-auto">
            @for (entry of leaderboardEnt; track $index) {
              <div
                class="p-2 rounded flex justify-between font-medium"
                [ngClass]="entry.name === 'You' ? 'bg-blue-100 text-blue-900' : 'bg-gray-50 text-gray-900'">
                <span>{{ entry.name }}</span>
                <span>
                  {{ entry.attempts }} guesses â€“
                  {{ (entry.timeTaken / 1000) | number:'1.0-0' }} s
                </span>
              </div>
            }
          </div>
        }
      </div>
    </div>
  </div>
}

<!-- Game itself -->
<div class="min-h-screen flex flex-col items-center justify-center bg-slate-100">
  <div class="bg-white p-6 rounded-xl shadow-lg space-y-6">

    <!--Guesses area-->
    <div class="space-y-3.5">
      @for (guess of guesses; track $index) {
        <div class="flex gap-1 justify-center">
          @for (box of guess; track $index) {
            <div
              class="tile"
              [ngClass]="[
              box.revealed ? box.color : '',
              box.flip ? 'flip' : '',
              box.pop ? 'pop' : '']"
            >{{ box.letter }}
            </div>
          }
        </div>
      }
    </div>
    <!-- Message area -->
    @if (message) {
      <div class="alert alert-warning shadow-lg animate-slide-down max-w-md mx-auto">
        <span class="font-semibold">{{ message }}</span>
      </div>
    }

    <!-- Keyboard -->
    <div class="keyboard space-y-2 select-none">
      <div class="flex gap-1 justify-center">
        @for (letter of top; track $index) {
          <button
            class="key"
            (click)="letterClicked(letter)">
            {{ letter }}
          </button>
        }
      </div>
      <div class="flex gap-1 justify-center">
        @for (letter of middle; track $index) {
          <button
            class="key"
            (click)="letterClicked(letter)">
            {{ letter }}
          </button>
        }
      </div>
      <div class="flex gap-1 justify-center">
        <!-- Delete button -->
        <button
          (click)="deleteClicked()"
          class="key key-wide">
          âŒ«
        </button>
        <!-- letters -->
        @for (letter of bottom; track $index) {
          <button
            class="key"
            (click)="letterClicked(letter)">
            {{ letter }}
          </button>
        }
        <!-- Enter button -->
        <button
          (click)="enterClicked()"
          class="key key-wide">
          â†µ
        </button>
      </div>
    </div>
  </div>
</div>

